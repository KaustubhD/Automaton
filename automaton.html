<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Automaton Rule 110</title>
</head>
<style>
  :root{
    --dim: 13px;
  }
  body{
    margin: 0;
    background-color: #000;
  }
  .row{
    height: var(--dim);
  }
  .row div{
    display: inline-block;
    height: var(--dim);
    width: var(--dim);
    /* margin: 1px; */
  }
  .active{
    background-color: #8BC34A;
    /* background-color: #673AB7; */
  }
  .inactive{
    background-color: #303F9F;
    /* background-color: #D1C4E9; */
  }
</style>
<body>
  <div class="container">
    <div class="row"></div>
  </div>
</body>

<script>

let screenWidth = window.innerWidth
let screenHeight = window.innerHeight
// let height = 500

let cellDimension = 12
document.documentElement.style.setProperty('--dim', `${cellDimension}px`)
let cellsInRow = Math.floor(screenWidth / cellDimension)
let numRows = Math.floor(screenHeight / cellDimension)
console.log('Num Cols', cellsInRow)
console.log('Num Rows', screenHeight)

let container = document.querySelector('div.container')
let firstRow = document.querySelector('div.row')
let cell = null

// -----Start for first row
for(let i = 0; i < cellsInRow; i++){
  cell = document.createElement('div')
  firstRow.appendChild(cell)
}
randomiseRow(firstRow)
  // To be used with first row only
function randomiseRow(rowElement){
  let x = null
  for(let i = 0; i < firstRow.childNodes.length; i++){
    x = firstRow.childNodes[i]
    x.classList.add(Math.random() <= 0.5 ? 'active' : 'inactive')
  }
  //   firstRow.childNodes[i].classList.add('inactive')
  // }
  // firstRow.childNodes[firstRow.childNodes.length / 2].classList.remove('inactive')
  // firstRow.childNodes[firstRow.childNodes.length / 2].classList.add('active')
}

// -----Ending for first row


function duplicateRow(){
  let allRows = document.querySelectorAll('.row')
  let newRow = firstRow.cloneNode(true)
  container.appendChild(newRow)
  operateOnNewRow(newRow, allRows[allRows.length - 1])
}

function operateOnNewRow(currentRow, prevRow){
  // console.log(currentRow)
  // console.log(prevRow)
  let currentChildren = currentRow.childNodes
  let prevChildren = prevRow.childNodes
  for(let cell = 0; cell < currentChildren.length; cell++){
    let prev = prevChildren[cell]
    let prevLeft = prevChildren[cell].previousElementSibling || prevChildren[prevChildren.length - 1]
    let prevRight = prevChildren[cell].nextElementSibling || prevChildren[0]
    changeChildState(currentChildren[cell], prevLeft, prev, prevRight)
  }
}

function changeChildState(current, prevLeft, prev, prevRight){
//  console.log('Current', current)
//  console.log('prevLeft', prevLeft)
//  console.log('prev', prev)
//  console.log('prevRight', prevRight)
 current.className = ''
 if( isActive(prevLeft) && isActive(prev) && isActive(prevRight) ){
   current.classList.add('active')
 }
 else if( isActive(prevLeft) && isActive(prev) && !isActive(prevRight) ){
   current.classList.add('inactive')
 }
 else if( isActive(prevLeft) && !isActive(prev) && isActive(prevRight) ){
   current.classList.add('inactive')
 }
 else if( isActive(prevLeft) && !isActive(prev) && !isActive(prevRight) ){
   current.classList.add('active')
 }
 else if( !isActive(prevLeft) && isActive(prev) && isActive(prevRight) ){
   current.classList.add('inactive')
 }
 else if( !isActive(prevLeft) && isActive(prev) && !isActive(prevRight) ){
   current.classList.add('active')
 }
 else if( !isActive(prevLeft) && !isActive(prev) && isActive(prevRight) ){
   current.classList.add('active')
 }
 else if( !isActive(prevLeft) && !isActive(prev) && !isActive(prevRight) ){
   current.classList.add('inactive')
 }
 if(current.classList.length == 0)
  current.classList.add('inactive')
}

function isActive(element){
  return element.classList.contains('active') ? 1 : 0
}

let countIters = 0
let a = setInterval(function(){
  duplicateRow()
  countIters++
  if(countIters >= numRows - 1){ clearInterval(a) }
}, 100)










</script>
</html>